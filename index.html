<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISCartuchos - Sistema Completo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- ESTILOS GENERALES --- */
        :root { --bg-desktop: #2c3e50; --win-bg: #e0e0e0; --win-header: linear-gradient(to right, #000080, #1084d0); --input-border: #7f9db9; }
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; background: var(--bg-desktop); overflow: hidden; height: 100vh; display: flex; flex-direction: column; user-select: none; }
        
        /* Scrollbars */
        ::-webkit-scrollbar { width: 12px; height: 12px; }
        ::-webkit-scrollbar-track { background: #f0f0f0; }
        ::-webkit-scrollbar-thumb { background: #cdcdcd; border: 1px solid #fff; }

        /* --- MEN√ö Y TOOLBAR --- */
        .top-menu { background: #f0f0f0; padding: 2px 10px; border-bottom: 1px solid #d0d0d0; display: flex; gap: 15px; color: #000; }
        .menu-item { cursor: pointer; } .menu-item:hover { background-color: #316ac5; color: white; }
        
        .toolbar { background: #ffffff; border-bottom: 1px solid #888; padding: 5px 10px; display: flex; align-items: center; height: 65px; flex-shrink: 0; gap: 10px; }
        
        .tools-left { display: flex; align-items: center; gap: 2px; }
        .tool-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 75px; height: 60px; border: 1px solid transparent; cursor: pointer; border-radius: 3px; color: #000; }
        .tool-btn:hover { border: 1px solid #aaa; background: #e0e0e0; box-shadow: inset 0 0 3px white; }
        .tool-icon { font-size: 32px; margin-bottom: 3px; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2)); }
        .tool-text { font-size: 10px; font-weight: bold; color: #333; font-family: Tahoma, sans-serif; }
        .separator { width: 1px; height: 40px; background: #ccc; margin: 0 5px; border-right: 1px solid #fff; }
        
        .search-container { border: 1px solid #ccc; border-radius: 4px; padding: 3px; background: #f9f9f9; display: flex; flex-direction: column; align-items: flex-start; margin-left: 10px; }
        .search-label { font-size: 10px; color: #333; margin-bottom: 2px; margin-left: 2px; }
        .search-box { display: flex; gap: 0; }
        
        .search-input { width: 100px; border: 1px solid #7f9db9; font-size: 12px; padding: 2px; outline: none; height: 8mm; }
        .search-btn { border: 1px solid #7f9db9; border-left: none; background: #e0e0e0; cursor: pointer; font-weight: bold; width: 25px; height: 8mm; } .search-btn:active { background: #ccc; }

        /* --- VENTANAS --- */
        .window { position: absolute; background: var(--win-bg); border: 2px solid #fff; border-right-color: #444; border-bottom-color: #444; box-shadow: 10px 10px 30px rgba(0,0,0,0.5); display: none; flex-direction: column; width: 700px; max-height: 95vh; touch-action: none; border-radius: 4px; outline: 1px solid #000080; }
        .title-bar { background: var(--win-header); color: white; padding: 6px 8px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: move; font-size: 13px; height: 25px; border-bottom: 1px solid #000; }
        .btn-close { background: #c0392b; color: white; width: 20px; height: 18px; border-radius: 2px; line-height: 16px; text-align: center; border: 1px solid #fff; cursor: pointer; font-size: 12px; font-weight: bold; }
        .win-body { padding: 6px; flex: 1; display: flex; flex-direction: column; gap: 4px; overflow-y: auto; background: #d4d0c8; }

        /* --- CONTROLES DE FORMULARIO --- */
        fieldset { border: 1px solid #999; padding: 5px; border-radius: 3px; margin: 0; }
        legend { font-size: 10px; color: #333; font-weight: bold; margin-bottom: 0px; }
        
        .os-row { display: flex; gap: 5px; align-items: center; }
        .os-label { font-size: 10px; color: #444; }
        .os-input { border: 1px solid #7f9db9; height: 8mm; font-size: 12px; padding: 0 4px; box-sizing: border-box; }
        .os-input[readonly] { background: #eee; color: #555; }
        .os-btn { background: #e0e0e0; border: 1px solid #7f9db9; cursor: pointer; font-size: 11px; padding: 0 8px; box-shadow: 1px 1px 1px rgba(0,0,0,0.1); height: 8mm; display:flex; align-items:center; justify-content:center; }
        .os-btn:active { transform: translateY(1px); }

        /* Tabs Generales */
        .win-tabs { display: flex; gap: 5px; margin-bottom: 5px; border-bottom: 1px solid #999; padding-bottom: 5px; }
        .win-tab { text-align: center; padding: 3px 15px; background: #e0e0e0; border: 1px solid #7f9db9; cursor: pointer; color: #333; font-size: 11px; border-radius: 2px; box-shadow: 1px 1px 1px rgba(0,0,0,0.1); }
        .win-tab:hover { background: #f0f0f0; }
        .win-tab.active { background: #fff; border: 1px solid #000080; color: #000; font-weight: bold; }

        .tab-content { border: 1px solid #7f9db9; background: #f0f0f0; padding: 8px; flex: 1; display: none; flex-direction: column; gap: 5px; }
        .tab-content.active { display: flex; }

        /* Grillas */
        .data-grid { background: #fff; border: 1px solid #7f9db9; width: 100%; border-collapse: collapse; font-size: 10px; table-layout: fixed; }
        .data-grid th { background: #e0e0e0; border-bottom: 1px solid #999; padding: 2px; text-align: left; font-weight: normal; border-right: 1px solid #ccc; white-space: nowrap; overflow: hidden; }
        .data-grid td { padding: 2px; border-bottom: 1px solid #eee; border-right: 1px solid #eee; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .data-grid tr:hover { background: #ffffcc; }
        .data-grid tr.selected-row { background-color: #000080; color: white; }
        .data-grid tr.selected-row td { color: white; border-right: 1px solid #999; }

        .grid-wrapper { border: 1px solid #999; background: #fff; overflow-y: auto; height: 100px; }
        .products-wrapper { border: 1px solid #999; background: #fff; overflow-y: scroll; margin-top: 5px; height: 125px; min-height: 125px; max-height: 125px; flex: 0 0 125px; }

        .list-toolbar { display: flex; gap: 5px; align-items: center; padding: 5px; background: #d4d0c8; border-bottom: 1px solid #999; }

        .client-form { display: flex; flex-direction: column; gap: 6px; }
        .frm-row { display: flex; gap: 5px; width: 100%; align-items: flex-end; }
        .frm-col { display: flex; flex-direction: column; gap: 1px; }
        .frm-input, .frm-select { border: 1px solid #7f9db9; padding: 2px 4px; font-size: 12px; height: 8mm; width: 100%; box-sizing: border-box; background: #fff; }
        .frm-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .bottom-actions { display: flex; justify-content: flex-end; align-items: center; gap: 15px; margin-top: 5px; padding-top: 5px; border-top: 1px solid #ccc; }
        .big-btn-group { display: flex; gap: 5px; }
        .big-btn { display: flex; flex-direction: column; align-items: center; padding: 4px 8px; border: 1px solid #7f9db9; background: #e0e0e0; cursor: pointer; border-radius: 3px; min-width: 60px; }
        .big-btn:hover { background: #d0d0d0; }
        .frm-textarea { border: 1px solid #7f9db9; font-family: sans-serif; font-size: 11px; height: 50px; resize: none; width: 100%; box-sizing: border-box; }
        .frm-label { font-size: 10px; color: #444; }

        .chart-container { background: #fff; border: 1px solid #888; box-shadow: inset 1px 1px 3px #ccc; padding: 10px; flex: 1; min-height: 300px; position: relative;}
        .chart-controls { border: 1px solid #aaa; border-radius: 4px; padding: 5px; background: #e0e0e0; margin-top: 5px; display: flex; align-items: center; gap: 10px; }
        .chart-fieldset { border: 1px solid #999; padding: 3px 8px; border-radius: 3px; display: flex; gap: 10px; align-items: center; }

        .mid-btn { width: 100%; height: 35px; margin-bottom: 5px; border: 1px solid #999; background: #e0e0e0; border-radius: 4px; font-weight: bold; cursor: pointer; box-shadow: 1px 1px 2px #aaa; }
        .mid-btn:active { transform: translateY(1px); box-shadow: inset 1px 1px 2px #aaa; }
    </style>
</head>
<body>

    <div class="top-menu">
        <span class="menu-item">Archivo</span><span class="menu-item">Registro</span><span class="menu-item">Informes</span><span class="menu-item">Herramientas</span><span class="menu-item">Ventana</span><span class="menu-item">Ayuda</span>
    </div>

    <div class="toolbar">
        <div class="tools-left">
            <div class="tool-btn" onclick="abrirVentana('winTotalizador')"><span class="tool-icon">üóÑÔ∏è</span><span class="tool-text">TOTALIZADOR</span></div>
            <div class="tool-btn" onclick="abrirVentana('winOS')"><span class="tool-icon">üìÇ</span><span class="tool-text">O.S.</span></div>
            <div class="separator"></div>
            <div class="tool-btn" onclick="abrirVentana('winClientes')"><span class="tool-icon">üë§</span><span class="tool-text">CLIENTES</span></div>
            <div class="tool-btn" onclick="abrirVentana('winProductos')"><span class="tool-icon">‚óºÔ∏è</span><span class="tool-text">PRODUCTOS</span></div>
            <div class="tool-btn" onclick="abrirVentana('winGraficos')"><span class="tool-icon">üìä</span><span class="tool-text">GR√ÅFICOS</span></div>
            <div class="separator"></div>
            <div class="tool-btn" onclick="alert('Ayuda')"><span class="tool-icon">‚ùì</span><span class="tool-text">AYUDA</span></div>
            <div class="separator"></div>
            <div class="tool-btn" onclick="abrirVentana('winBackup')"><span class="tool-icon">üíæ</span><span class="tool-text">BACKUP</span></div>
            <div class="tool-btn" onclick="abrirVentana('winOpciones')"><span class="tool-icon">üõ†Ô∏è</span><span class="tool-text">OPCIONES</span></div>
            <div class="tool-btn" onclick="salirDelSistema()"><span class="tool-icon" style="color:red;">üî¥</span><span class="tool-text">SALIR</span></div>
            
            <div class="search-container">
                <span class="search-label">Buscar Serie</span>
                <div class="search-box">
                    <input type="text" class="search-input">
                    <button class="search-btn">></button>
                </div>
            </div>
        </div>
    </div>

    <div style="position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; color:rgba(255,255,255,0.1); z-index: -1;">
        <h1 style="font-size: 100px; margin:0;">SIS</h1>
    </div>

    <div id="winTotalizador" class="window" style="top:80px; left:20px; width: 750px; height: 500px;">
        <div class="title-bar"><span>Totalizador</span><span class="btn-close" onclick="cerrarVentana('winTotalizador')">‚úï</span></div>
        <div class="win-body" style="background:#e0e0e0;">
            <div style="display:flex; gap:10px;">
                <button class="os-btn" style="width:100px; height:50px; font-weight:bold;" onclick="limpiarTotalizador()">Nueva Ejecuci√≥n</button>
                <fieldset style="flex:1;">
                    <legend>Operaci√≥n</legend>
                    <div style="display:flex; gap:10px;">
                        <label><input type="radio" name="totOp" checked> Recargue</label>
                        <label><input type="radio" name="totOp"> Venta</label>
                        <label><input type="radio" name="totOp"> Reventa</label>
                    </div>
                </fieldset>
                <fieldset style="flex:1.5;">
                    <legend>Cliente/Distribuidor</legend>
                    <div style="display:flex; gap:5px; align-items:center;">
                        <input type="text" id="txtClienteTot" list="listClientesTot" class="frm-input" style="flex:1;" placeholder="Buscar cliente...">
                        <datalist id="listClientesTot"></datalist>
                        <button class="os-btn" style="height:22px; width:50px; font-weight:bold;" onclick="abrirVentanaProdXCliente()">Nuevo</button>
                    </div>
                </fieldset>
            </div>
            <div style="display:flex; gap:10px; margin-top:5px;">
                <fieldset style="flex:1;">
                    <legend>Producto</legend>
                    <div class="os-row"><label>C√≥digo:</label><input type="checkbox" checked> Imprimir Cup√≥n</div>
                    <div class="os-row">
                        <input type="text" id="totProdCod" class="frm-input" style="width:60px;" placeholder="C√≥d">
                        <input type="text" id="totProdDesc" list="listProdsTot" class="frm-input" style="flex:1;" placeholder="Buscar producto..." oninput="buscarProductoTotalizador()">
                        <datalist id="listProdsTot"></datalist>
                    </div>
                    <div class="os-row" style="margin-top:10px;">
                        <div class="frm-col" style="flex:1;">
                            <span class="frm-label">PRECIO</span>
                            <input type="text" id="totPrecio" class="frm-input" style="width:100%; font-size:12px; font-weight:bold; color:red; text-align:center;" value="0.00">
                        </div>
                        <div class="frm-col" style="align-items:center;">
                            <span class="frm-label">CTD</span>
                            <input type="text" id="totCtd" class="frm-input" style="width:1cm; font-size:12px; font-weight:bold; text-align:center;" value="1">
                        </div>
                        <div class="frm-col" style="justify-content:flex-end;">
                            <button class="os-btn" style="width:1cm; height:22px; font-weight:bold;" onclick="calcularSubtotalTot()">=</button>
                        </div>
                        <div class="frm-col" style="flex:1;">
                            <span class="frm-label">SUBTOTAL</span>
                            <input type="text" id="totSubtotal" class="frm-input" style="width:100%;" disabled>
                        </div>
                    </div>
                    <div class="os-row" style="margin-top:5px; gap:5px; align-items:flex-end;">
                        <div class="frm-col" style="flex:1;"><span class="frm-label">TOTAL</span><input type="text" id="totTotal" class="frm-input" style="width:100%; font-weight:bold;" readonly></div>
                        <div class="frm-col" style="flex:1;"><span class="frm-label">DINERO</span><input type="text" class="frm-input" style="width:100%;"></div>
                        <button class="os-btn" style="width:1cm; height:22px; font-weight:bold;">+</button>
                        <div class="frm-col" style="flex:1;"><span class="frm-label">VOLTA</span><input type="text" class="frm-input" style="width:100%;" value="0.00"></div>
                    </div>
                </fieldset>
                <fieldset style="flex:1;">
                    <div class="os-row">
                        <div class="frm-col" style="flex:1;"><span class="frm-label">N√∫mero de serie</span><input type="text" id="totSerie" class="frm-input" style="width:100%;" maxlength="10" onblur="verificarSerieCliente()"></div>
                        <div class="frm-col" style="flex:1;"><span class="frm-label">Observaci√≥n</span><input type="text" id="totObs" class="frm-input" style="width:100%;"></div>
                    </div>
                    <div class="os-row" style="justify-content:center; margin:5px 0;"><label><input type="radio" name="pago"> $</label><label><input type="radio" name="pago"> O</label><label><input type="radio" name="pago"> Tarjeta</label><label><input type="radio" name="pago"> Cheque</label><label><input type="radio" name="pago"> Plazo</label></div>
                    <div class="os-row" style="align-items:center; gap:5px;"><span class="frm-label" style="margin-bottom:0;">Fecha de Facturaci√≥n:</span><input type="date" class="frm-input" style="flex:1;"><input type="text" class="frm-input" style="flex:1;"></div>
                    <button class="os-btn" style="width:100%; background:#9f9; font-weight:bold; height:25px; margin-top:5px;" onclick="agregarMovimientoTot()">+</button>
                    <button class="os-btn" style="width:100%; background:#f99; font-weight:bold; margin-top:5px; height:30px;">FINALIZAR</button>
                </fieldset>
            </div>
            <fieldset style="flex:1; margin-top:5px;">
                <legend>Movimiento en curso</legend>
                <div class="grid-wrapper" style="height:150px;">
                    <table class="data-grid">
                        <thead><tr><th>Art√≠culo</th><th>Descripci√≥n</th><th>N√∫mero de serie</th><th>Precio Unid</th><th>CTD</th><th>Precio Total</th></tr></thead>
                        <tbody id="gridTotalizador"></tbody>
                    </table>
                </div>
            </fieldset>
            <div class="os-row" style="margin-top:5px;"><button class="os-btn">Abrir Tot.</button><button class="os-btn">Cierre Tot.</button><button class="os-btn">Suministrar</button><button class="os-btn">Contracargo</button><button class="os-btn" style="margin-left:auto;">Informe</button></div>
        </div>
    </div>

    <div id="winProdXCliente" class="window" style="top:100px; left:100px; width: 450px; height: 400px; z-index:2000;">
        <div class="title-bar"><span>Registro de Productos X Cliente</span><span class="btn-close" onclick="cerrarVentana('winProdXCliente')">‚úï</span></div>
        <div class="win-body">
            
            <fieldset>
                <legend>Cliente</legend>
                <input type="text" id="txtClientePXC" list="listClientesPXC" class="frm-input" style="width:100%; font-weight:bold; color:blue;" placeholder="Buscar cliente...">
                <datalist id="listClientesPXC"></datalist>
            </fieldset>

            <fieldset style="flex:1; display:flex; flex-direction:column;">
                <legend>Producto</legend>
                
                <div style="display:flex; border-bottom:1px solid #999; margin-bottom:5px;">
                    <div style="padding:3px 10px; background:#fff; border:1px solid #999; border-bottom:none; font-weight:bold;">Agregar</div>
                    <div style="padding:3px 10px; background:#ddd; border:1px solid #999; border-bottom:none; color:#666;">Eliminar</div>
                </div>

                <div style="display:flex; flex-direction:column; gap:5px;">
                    <div class="os-row">
                        <div class="frm-col" style="flex:1;">
                            <span class="frm-label">Fabricante</span>
                            <select id="pxcFab" class="frm-select" onchange="cargarModelosPXC()">
                                <option value="">- Seleccione -</option>
                            </select>
                        </div>
                        <div class="frm-col" style="flex:1;">
                            <span class="frm-label">Modelo</span>
                            <select id="pxcMod" class="frm-select"></select>
                        </div>
                    </div>
                    
                    <div class="os-row" style="align-items:flex-end;">
                        <div class="frm-col" style="flex:1;">
                            <span class="frm-label">Numero de serie</span>
                            <input type="text" id="pxcSerie" class="frm-input" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                        </div>
                        <button class="os-btn" style="height:22px;" onclick="agregarProductoACliente()">Agregar</button>
                    </div>
                </div>

                <div class="grid-wrapper" style="margin-top:10px; flex:1; height:120px;">
                    <table class="data-grid">
                        <thead><tr><th>Marca</th><th>Modelo</th><th>Serie</th></tr></thead>
                        <tbody id="gridPXC"></tbody>
                    </table>
                </div>
            </fieldset>

            <div style="display:flex; justify-content:flex-end; margin-top:5px;">
                <button class="os-btn" style="width:80px;" onclick="limpiarPXC()">Limpio</button>
            </div>
        </div>
    </div>

    <div id="winOS" class="window" style="top:80px; left:20px; width: 780px; height: 580px;"><div class="title-bar"><span>Orden de Servicio</span><span class="btn-close" onclick="cerrarVentana('winOS')">‚úï</span></div><div class="win-body"><div style="display:flex; flex-direction:column; gap:5px;"><div style="border:1px solid #7f9db9; background:#fff; height: 100px; overflow-y:scroll;"><table class="data-grid"><thead><tr><th style="width: 50px;">C√≥digo</th><th style="width: 200px;">Nombre</th><th>Direcci√≥n</th></tr></thead><tbody id="gridClientesOS"></tbody></table></div><div style="margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px solid #aaa;"><div class="os-row" style="margin-bottom: 2px;"><div style="width: 80px; font-size:10px; color:#444;">C√≥digo</div><div style="flex:1; font-size:10px; color:#444;">Nombre del Cliente (Escriba para buscar)</div></div><div class="os-row"><input type="text" id="osCliCodigo" class="os-input" style="width: 80px; text-align:center; font-weight:bold; height: 8mm;" readonly placeholder="Cod"><input type="text" id="osCliNombre" class="os-input" style="flex:1; font-weight:bold; height: 8mm;" placeholder="Escriba aqu√≠ para buscar en la lista de arriba..." onkeyup="filtrarClientesOS()"><button class="os-btn" style="height: 8mm;" onclick="abrirVentana('winClientes')">Registro de Clientes</button></div></div></div><div class="win-tabs"><div class="win-tab active" onclick="switchTab('os', 'Abrir')" id="tabosAbrir">Abrir O.S.</div><div class="win-tab" onclick="switchTab('os', 'Leer')" id="tabosLeer">Leer o Cerrar</div><div class="win-tab" onclick="alert('Funcionalidad de pagos')">Confirmar el pago</div></div><div id="contentosAbrir" class="tab-content active" style="border:none; padding:0; background:transparent;"><div style="display: flex; gap: 10px; height: 100%; flex:1;"><div style="flex: 1.2; display: flex; flex-direction: column; gap: 5px;"><fieldset style="flex:1; display:flex; flex-direction:column; gap:4px;"><legend>Inserte Productos</legend><label class="os-label">Descripci√≥n</label><select id="osProdDesc" class="os-input" style="width:100%;"><option value="Recarga de Cartucho">Recarga de Cartucho</option><option value="Mantenimiento">Mantenimiento</option></select><label class="os-label">Producto (Escriba para buscar)</label><input type="text" id="osProdItem" list="listaProductosOS" class="os-input" style="width:100%;" placeholder="Escriba c√≥digo o descripci√≥n..." oninput="detectarPrecioProducto()"><datalist id="listaProductosOS"></datalist><div class="os-row" style="align-items: flex-end;"><div style="width: 40px;"><label class="os-label">CTD</label><input type="number" id="osCtd" class="os-input" value="1" style="width: 100%;"></div><div style="flex: 1;"><label class="os-label">Chasis / Serie</label><input type="text" id="osSerie" class="os-input" style="width: 100%;"></div><div style="width: 70px;"><label class="os-label">Valor ($)</label><input type="text" id="osValor" class="os-input" style="width: 100%;"></div><button class="os-btn" style="width: 30px; font-weight:bold; height: 8mm;" onclick="agregarProductoOS()" title="Agregar">+</button><button class="os-btn" style="height: 8mm;" onclick="limpiarInputsProducto()">Limpio</button></div><div id="wrapperProductos" class="products-wrapper"><table class="data-grid"><thead><tr><th style="width:20px;">Art√≠c</th><th>Descripci√≥n</th><th>Serie</th><th>Valor</th></tr></thead><tbody id="gridProductosAgregados"></tbody></table></div></fieldset></div><div style="flex: 0.8; display: flex; flex-direction: column; gap: 5px; height: 100%;"><div style="flex: 1; display:flex; flex-direction:column; gap:2px;"><div style="display: flex; justify-content: space-between; align-items: center;"><label class="os-label">Observaciones:</label><div style="display: flex; align-items: center; gap: 5px; background: #ddd; padding: 0 5px; border-radius: 3px; border:1px solid #aaa;"><input type="checkbox" id="chkEntregar" style="margin: 3px 0;"> <label for="chkEntregar" class="os-label" style="font-weight: bold; cursor: pointer;">Entregar</label></div></div><textarea id="osObs" class="os-input" style="flex: 1; width: 100%; resize:none; height:auto; font-family: sans-serif;"></textarea></div><div style="margin-top: 5px;"><label class="os-label">Previsi√≥n de entrega (Fecha y Hora)</label><div class="os-row" style="align-items: flex-end;"><input type="date" id="osFechaEntrega" class="os-input" style="width: 110px;"><input type="time" id="osHoraEntrega" class="os-input" style="flex:1;"><div style="display: flex; flex-direction: column; align-items: center; margin-left: 5px; gap: 0;"><span class="os-label" style="margin-bottom: 2px;">V√≠as</span><input type="text" class="os-input" value="1" style="width: 40px; text-align:center;"></div></div><button class="os-btn" style="width:100%; height: 40px; margin-top: 10px; font-weight:bold;" onclick="generarOS()">ABRIR ORDEN</button></div></div></div></div><div id="contentosLeer" class="tab-content" style="border:none; padding:20px 0 0 20px; background:transparent; display:none; justify-content: flex-start;"><fieldset style="width: 350px; padding: 20px; background: #fff; display: flex; flex-direction: column; align-items: center; gap: 15px;"><legend>Orden de Servicio</legend><button class="mid-btn" onclick="abrirVentana('winListaOS')">Ver, Editar o Cerrar O.S.</button><button class="mid-btn" onclick="abrirVentana('winTotalizador')">Llamar totalizador</button><div style="margin-top: 10px; font-size: 10px; color: #666;">Haga clic en Ver para ver O.S. en curso</div></fieldset></div></div></div>
    <div id="winListaOS" class="window" style="top:80px; left:50px; width: 780px; height: 550px;"><div class="title-bar"><span>Orden de Servicio - Ordenes Abiertas</span><span class="btn-close" onclick="cerrarVentana('winListaOS')">‚úï</span></div><div class="win-body"><div class="list-toolbar"><input type="text" id="filtroClienteHistorial" list="listaClientesHistorial" class="os-input" style="width:200px;" placeholder="Buscar cliente..." oninput="actualizarListaOSGlobal()"><datalist id="listaClientesHistorial"></datalist><label><input type="radio" name="filtroOS" value="abiertas" checked onclick="actualizarListaOSGlobal()"> Abiertas</label><label><input type="radio" name="filtroOS" value="cerradas" onclick="actualizarListaOSGlobal()"> Cerradas</label><label><input type="radio" name="filtroOS" value="todas" onclick="actualizarListaOSGlobal()"> Todas</label><button class="os-btn" onclick="actualizarListaOSGlobal()">Buscar</button><button class="os-btn" style="font-weight: bold; color: darkred;" onclick="cerrarOSSeleccionada()">Cerrar</button><button class="os-btn">Cerrar todo</button></div><div class="grid-wrapper" style="height: 5cm;"><table class="data-grid"><thead><tr><th style="width: 3cm;">O.S. Num</th><th style="width: 8cm;">Descripci√≥n / Producto</th><th style="width: 1.5cm;">Estado</th></tr></thead><tbody id="listaOSGlobal"></tbody></table></div><div class="grid-wrapper" style="height: 3.5cm; flex:none; margin-top:5px;"><table class="data-grid"><thead><tr><th style="width:1.4cm; text-align:right;">Art.</th><th style="width:6.5cm; text-align:left;">Descripci√≥n</th><th style="width:3.5cm; text-align:right;">Producto</th><th style="width:2.5cm; text-align:left;">Serie</th><th style="width:2.3cm; text-align:left;">Valor Un.</th><th style="width:1cm; text-align:left;">CTD</th><th style="width:1.5cm; text-align:right;">Subtotal</th></tr></thead><tbody id="detalleOSSeleccionada"></tbody></table></div><textarea id="txtDetalleObs" class="os-input" style="width:98%; height:2cm; resize:none; margin: 5px auto; display:block; background:#fff;" placeholder="Observaciones (Editable)..."></textarea><div class="os-row" style="justify-content:flex-start; align-items:center; margin-top:5px; gap:5px; padding-left: 5px;"><input type="text" id="txtInfoNum" class="os-input" style="width:1.4cm; height:25px; font-weight:bold; font-size:11px; text-align:center;" readonly placeholder="Num"><input type="text" id="txtInfoFecha" class="os-input" style="width:2.2cm; height:25px; font-weight:bold; font-size:11px; text-align:center;" readonly placeholder="Fecha"><input type="text" id="txtInfoCliente" class="os-input" style="width:10cm; height:25px; font-weight:bold; font-size:11px;" readonly placeholder="Nombre del Cliente"><button class="os-btn" style="height:25px; width:3cm;" onclick="if(osSeleccionada) imprimirTicket(osSeleccionada); else alert('Seleccione una OS primero');">Imprimir</button><button class="os-btn" style="height:25px; width:2.5cm;" onclick="guardarCambiosOS()">Guardar</button></div></div></div>
    <div id="winProductos" class="window" style="top:80px; left:80px; width: 700px; height: 450px;"><div class="title-bar"><span>Registro de Productos</span><span class="btn-close" onclick="cerrarVentana('winProductos')">‚úï</span></div><div class="win-body" style="background: #e0e0e0;"><div class="win-tabs"><div class="win-tab active" onclick="switchTab('prod', 'Fab')" id="tabprodFab">Fabricantes</div><div class="win-tab" onclick="switchTab('prod', 'Prod')" id="tabprodProd">Productos</div><div class="win-tab" onclick="switchTab('prod', 'Ext')" id="tabprodExt">Existencias</div></div><div id="contentprodProd" class="tab-content" style="display:none; flex-direction:column; gap:5px;"><fieldset><legend>Identificaci√≥n</legend><div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 5px;"><label><input type="radio" name="prodMode" value="nuevo" id="chkProdNuevo" onclick="toggleModoProducto('nuevo')"> Nuevo Registro</label><label><input type="radio" name="prodMode" value="cambiar" id="chkProdCambiar" onclick="toggleModoProducto('cambiar')"> Cambiar</label></div><div class="os-row"><div class="frm-col" style="flex:1;"><span class="frm-label">Fabricante</span><select id="regProdFabSel" class="frm-select" onchange="seleccionarFabricante()"></select></div><div class="frm-col" style="flex:1;"><span class="frm-label">Modelo</span><select id="regProdModSel" class="frm-select" disabled onchange="seleccionarModelo()"></select></div></div><div class="os-row" style="margin-top:5px;"><input type="text" id="regProdDesc" class="frm-input" style="width:100%;" placeholder="Descripci√≥n / C√≥digo pintado..."></div><div class="os-row" style="margin-top:5px;"><div class="frm-col" style="width:100px;"><span class="frm-label">Unidad</span><select class="frm-select"><option>pc</option></select></div></div><fieldset style="margin-top:5px;"><legend>Tipo</legend><div style="display:flex; gap:15px;"><label><input type="radio" name="prodType" checked> Cartucho</label><label><input type="radio" name="prodType"> Servicios</label><label><input type="radio" name="prodType"> Otro</label></div></fieldset></fieldset><fieldset style="margin-top: 5px;"><legend>Valor</legend><div style="display: flex; justify-content: space-between; align-items: flex-end;"><div style="display: flex; gap: 5px;"><div class="frm-col" style="width:2cm;"><span class="frm-label">Recarga</span><input type="text" id="regProdP1" class="frm-input" value="0.00"></div><div class="frm-col" style="width:2cm;"><span class="frm-label">Venta</span><input type="text" id="regProdP2" class="frm-input" value="0.00"></div><div class="frm-col" style="width:2cm;"><span class="frm-label">Reventa</span><input type="text" id="regProdP3" class="frm-input" value="0.00"></div></div><div style="display: flex; gap: 5px;"><button class="os-btn" style="width:2.5cm;">Guardar</button><button class="os-btn" style="width:2.5cm;">Borrar</button><button class="os-btn" style="width:2.5cm;" onclick="cerrarVentana('winProductos')">Cancelar</button></div></div></fieldset></div><div id="contentprodFab" class="tab-content active" style="display:flex; flex-direction:column; gap:5px;"><fieldset><legend>Mantenimiento de Fabricantes</legend><div style="display: flex; justify-content: flex-start; gap: 10px; margin-bottom: 5px;"><label><input type="radio" name="fabMode" checked> Nuevo Registro</label><label><input type="radio" name="fabMode"> Cambiar</label></div><div class="os-row" style="align-items:flex-end;"><div class="frm-col" style="width:1cm;"><span class="frm-label">C√≥digo</span><input type="text" class="frm-input" style="width:100%;"></div><div class="frm-col" style="flex:1;"><span class="frm-label">Fabricante</span><input type="text" class="frm-input" style="width:100%;"></div><div class="frm-col" style="flex:1;"><span class="frm-label">Seleccionar</span><select class="frm-select" id="selFabList"></select></div></div><div style="display: flex; gap: 5px; margin-top: 10px; justify-content:flex-end;"><button class="os-btn" style="width:2.5cm;">Guardar</button><button class="os-btn" style="width:2.5cm;">Borrar</button><button class="os-btn" style="width:2.5cm;">Cerrar</button></div></fieldset></div><div id="contentprodExt" class="tab-content" style="display:none; flex-direction:column; gap:10px;"><fieldset style="flex:1;"><legend>Control de Existencias</legend><div style="display: flex; gap: 10px;"><div style="flex: 1; display:flex; flex-direction:column; gap:5px;"><div class="os-row"><div class="frm-col" style="flex:1;"><span class="frm-label">Fabricante</span><select class="frm-select"><option>HP</option><option>Samsung</option></select></div><div class="frm-col" style="flex:1;"><span class="frm-label">Modelo</span><select class="frm-select"><option>85A</option><option>101</option></select></div></div><div class="os-row" style="margin-top:10px; align-items:flex-end;"><div class="frm-col"><span class="frm-label">Stock</span><input type="text" class="frm-input" style="width:80px; text-align:center;" value="0"></div><button class="os-btn">Actualizaci√≥n</button></div></div><div style="display:flex; flex-direction:column; align-items:center; gap:5px;"><input type="text" style="width:3.5cm; height:4.5cm; border:1px solid #7f9db9;"><div style="display:flex; gap:5px;"><button class="os-btn" style="font-size:10px;">Abriendo fotos</button><button class="os-btn" style="font-size:10px;">Ver informe</button></div></div></div></fieldset></div></div></div>
    <div id="winClientes" class="window" style="top:80px; left:50px;"><div class="title-bar"><span>Registro del Cliente</span><span class="btn-close" onclick="cerrarVentana('winClientes')">‚úï</span></div><div class="win-body" style="background: #e4e4e4;"><div class="client-form"><div class="frm-header"><span style="font-size:12px; font-weight:bold;">Datos del Cliente</span><div class="frm-radios"><label style="cursor:pointer;"><input type="radio" name="modo" value="nuevo" checked onchange="cambiarModo('nuevo')"> Nuevo Registro</label><label style="cursor:pointer;"><input type="radio" name="modo" value="cambiar" onchange="cambiarModo('cambiar')"> Cambiar</label></div></div><div class="frm-row"><div class="frm-col" style="width: 80px;"><span class="frm-label">C√≥digo</span><input type="text" id="cliCodigo" class="frm-input" value="AUTO" disabled></div><div class="frm-col" style="width: 90%;"><span class="frm-label">Nombre del Cliente</span><div style="display: flex; gap: 5px;"><input type="text" id="cliNombre" class="frm-input" style="flex: 1.5;" placeholder="Nombre del cliente..."><input type="text" id="cliBusqueda" class="frm-input" style="flex: 1;" list="listaClientes" placeholder="üîç Buscar aqu√≠..." oninput="detectarCliente()" disabled><datalist id="listaClientes"></datalist></div></div></div><div class="frm-row"><div class="frm-col" style="flex: 1.5;"><span class="frm-label">Direcci√≥n</span><input type="text" id="cliDireccion" class="frm-input"></div><div class="frm-col" style="flex: 1;"><span class="frm-label">Colonia</span><input type="text" id="cliColonia" class="frm-input"></div></div><div class="frm-row"><div class="frm-col" style="flex: 1;"><span class="frm-label">Ciudad</span><input type="text" id="cliCiudad" class="frm-input"></div><div class="frm-col" style="flex: 1;"><span class="frm-label">Estado</span><input type="text" id="cliEstado" class="frm-input"></div><div class="frm-col" style="flex: 1.5;"><span class="frm-label">Nombre del Contacto</span><input type="text" id="cliContacto" class="frm-input"></div></div><div class="frm-row"><div class="frm-col" style="flex: 1;"><span class="frm-label">Tel√©fono 1</span><input type="text" id="cliTel1" class="frm-input"></div><div class="frm-col" style="flex: 0.5;"><span class="frm-label">C.P.</span><input type="text" id="cliCP" class="frm-input" style="text-align: center;"></div><div class="frm-col" style="flex: 1;"><span class="frm-label">Tel√©fono 2</span><input type="text" id="cliTel2" class="frm-input"></div></div><div class="frm-row"><div class="frm-col" style="flex: 1;"><span class="frm-label">Correo Electronico</span><input type="text" id="cliEmail" class="frm-input"></div></div><div class="frm-col"><span class="frm-label">Observaciones</span><textarea id="cliObs" class="frm-textarea"></textarea></div><div class="bottom-actions"><div class="frm-col" style="margin-right: auto;"><span class="frm-label">Fecha de registro</span><input type="date" class="frm-input" value="2025-01-27" style="width: 120px;"></div><div class="big-btn-group"><button class="big-btn" onclick="guardarCliente()"><span class="icon">üíæ</span><span style="font-size:10px;">Guardar</span></button><button class="big-btn" onclick="eliminarCliente()"><span class="icon">üóëÔ∏è</span><span style="font-size:10px;">Eliminar</span></button><button class="big-btn" onclick="limpiarFormularioClientes()"><span class="icon">üßπ</span><span style="font-size:10px;">Borrar</span></button><button class="big-btn" onclick="cerrarVentana('winClientes')"><span class="icon" style="color:red;">‚≠ï</span><span style="font-size:10px;">Cancelar</span></button></div></div></div></div></div>
    <div id="winBackup" class="window" style="top:80px; left:100px; width: 500px; height: 350px;"><div class="title-bar"><span>Asistente de copia de seguridad</span><span class="btn-close" onclick="cerrarVentana('winBackup')">‚úï</span></div><div class="win-body" style="display:flex; flex-direction:column; gap:10px;"><div style="padding: 10px; background:#fff; border:1px solid #ccc;">Seleccione la ruta de destino y pulse la Nueva copia de seguridad</div><fieldset><legend>Copia de seguridad actual</legend><div style="display: flex; gap: 5px;"><select class="frm-select" style="flex:1;"><option>C: [SSD Local]</option></select><div style="display: flex; flex-direction: column; gap: 3px;"><button class="os-btn" style="width: 80px;">Nuevo</button><button class="os-btn" style="width: 80px;">Restaurar</button></div></div><div style="height: 100px; border: 1px solid #999; background: #fff; margin-top: 5px; overflow-y:scroll;"><div style="padding:2px;">üìÅ C:\</div><div style="padding:2px; padding-left:15px;">üìÅ Program Files</div><div style="padding:2px; padding-left:30px; background:#000080; color:white;">üìÅ SISCartuchos</div></div></fieldset><fieldset><legend>Detalles de la √öltima copia de seguridad</legend><div class="os-row"><span style="width:50px;">Fecha:</span> <span>07. feb. 2025</span></div><div class="os-row"><span style="width:50px;">Horas:</span> <span>16:04:35</span></div><div class="os-row"><span style="width:50px;">Ruta:</span> <span style="font-size:9px;">C:\Archivos\Backup\2025\SISCartuchos_Backup.mdb</span></div></fieldset></div></div>
    <div id="winOpciones" class="window" style="top:80px; left:120px; width: 600px; height: 400px;"><div class="title-bar"><span>Opciones</span><span class="btn-close" onclick="cerrarVentana('winOpciones')">‚úï</span></div><div class="win-body"><div class="win-tabs"><div class="win-tab" onclick="switchTab('opc', 'Acc')" id="tabopcAcc">Acceso</div><div class="win-tab active" onclick="switchTab('opc', 'Cia')" id="tabopcCia">Compa√±√≠a</div><div class="win-tab" onclick="switchTab('opc', 'Gen')" id="tabopcGen">General</div><div class="win-tab" onclick="switchTab('opc', 'Per')" id="tabopcPer">Personalizaci√≥n</div></div><div id="contentopcCia" class="tab-content active" style="display:flex; flex-direction:column; gap:5px;"><fieldset><legend>Identificaci√≥n</legend><div class="frm-col"><span class="frm-label">Compa√±√≠a</span><input type="text" class="frm-input" value="SISCOBAJIO CELAYA TONER Y TINTAS"></div><div class="os-row"><div class="frm-col" style="flex:1;"><span class="frm-label">Direcci√≥n</span><input type="text" class="frm-input" value="Av. El Sauz 100 Laureles 1ra"></div><div class="frm-col" style="width:120px;"><span class="frm-label">Tel√©fono</span><input type="text" class="frm-input" value="461.613.5556"></div></div></fieldset><fieldset><legend>Plazo de Garant√≠a / Observaciones</legend><textarea class="frm-textarea" style="height:100px;">CONSEJOS PARA ALARGAR LA VIDA DE SUS CARTUCHOS: TONERS NO utilizar hojas gruesas, NO reciclar hojas...</textarea></fieldset><div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: auto;"><button class="os-btn">Guardar</button><button class="os-btn" onclick="cerrarVentana('winOpciones')">Cancelar</button></div></div><div id="contentopcAcc" class="tab-content" style="display:none;"><div class="os-row"><span style="width:80px;">Usuario:</span><input type="text" class="frm-input"></div></div><div id="contentopcGen" class="tab-content" style="display:none;"><label><input type="checkbox" checked> Opciones generales...</label></div><div id="contentopcPer" class="tab-content" style="display:none;"><span class="frm-label">Piel / Skin:</span><select class="frm-select"><option>Avenger</option></select></div></div></div>
    <div id="winGraficos" class="window" style="top:80px; left:60px; width: 750px; height: 500px;"><div class="title-bar"><span>Gr√°fico de Unidad Financiera</span><span class="btn-close" onclick="cerrarVentana('winGraficos')">‚úï</span></div><div class="win-body"><div style="text-align:center; margin-bottom: 5px; font-weight:bold; font-size:14px; font-family:'Tahoma';">VENDAS Y RECARGAS √öLTIMOS 12 MESES</div><div class="chart-container"><canvas id="miGrafico"></canvas></div><div class="chart-controls"><fieldset class="chart-fieldset"><legend class="chart-legend">Opciones</legend><select id="selPeriodo" class="frm-select" style="width: 100px;" onchange="actualizarGrafico()"><option value="meses">Meses</option><option value="semanas">Semanas</option></select><select id="selMesGrafico" class="frm-select" style="width: 120px; display:none;" onchange="actualizarGrafico()"><option value="ene">Enero</option><option value="feb">Febrero</option><option value="mar">Marzo</option><option value="abr">Abril</option></select><select id="selTipoGrafico" class="frm-select" style="width: 120px;"><option value="bar">Barras 2D</option><option value="bar3d">Barras 3D (Sim)</option><option value="line">L√≠neas 2D</option><option value="line3d">L√≠neas 3D (Sim)</option></select><button class="frm-input" style="width: 80px; background: #eee; cursor:pointer; font-weight:bold;" onclick="actualizarGrafico()">Exponer</button><button class="frm-input" style="width: 80px; background: #eee; cursor:pointer;" onclick="window.print()">Imprimir</button></fieldset></div></div></div>

<script>
    const DB_CLIENTES = [ { id: 2375, nombre: "EDIFICACIONES JUAN HERNANDEZ", direccion: "Josefa Ortiz de Dominguez #107", colonia: "Centro", ciudad: "Celaya", estado: "GTO", cp: "38000", contacto: "Juan", tel1: "461-111-2222", tel2: "461-333-4444", email: "juan@mail.com", obs: "Cliente frecuente" }, { id: 3913, nombre: "ERACLIO JUANDIEGO VAZQUEZ", direccion: "Venezuela #16", colonia: "Alameda", ciudad: "Cortazar", estado: "GTO", cp: "38300", contacto: "Maria", tel1: "411-555-6666", tel2: "", email: "maria@mail.com", obs: "Paga en efectivo" } ];
    const DB_PRODUCTOS = [ { codigo: "104 RCMLT-01045", desc: "104 RCMLT-01045", precio: 390.00 }, { codigo: "101 RCMLT-0101S", desc: "101 RCMLT-0101S", precio: 450.00 } ];
    const DB_AUTO_PARTS = { "HEWLETT PACKARD": [ { modelo: "85A", codigo: "HP-0085A", desc: "Cartucho Toner Negro 85A", recarga: 150, venta: 450, reventa: 400 } ], "CANON": [ { modelo: "128", codigo: "CN-0128", desc: "Cartucho Canon 128", recarga: 160, venta: 460, reventa: 410 } ] };
    // Mapeo de Cliente (ID) -> Lista de Series asociadas
    const DB_SERIES_CLIENTE = { "2375": ["1234567890", "ABC1234567"], "3913": ["9876543210"] }; 

    let itemsOrden = []; let ordenesGeneradas = []; let osSeleccionada = null; 

    window.onload = function() {
        activarArrastre();
        cargarListaDataList();
        cargarListaProductos();
        toggleModoProducto('cambiar');
        document.getElementById('osFechaEntrega').valueAsDate = new Date();
        const now = new Date();
        document.getElementById('osHoraEntrega').value = now.toTimeString().substring(0, 5);
    };
    
    function salirDelSistema() { const confirmar = confirm("¬øEst√° seguro que desea salir?"); if(confirmar) { window.close(); window.location.href = 'https://www.google.com'; } }
    function switchTab(prefix, tabName) { document.querySelectorAll(`.win-tab[id^="tab${prefix}"]`).forEach(t => t.classList.remove('active')); document.querySelectorAll(`.tab-content[id^="content${prefix}"]`).forEach(c => { c.classList.remove('active'); c.style.display = 'none'; }); document.getElementById(`tab${prefix}${tabName}`).classList.add('active'); const content = document.getElementById(`content${prefix}${tabName}`); content.classList.add('active'); if(prefix === 'os' && tabName === 'Abrir') content.style.display = 'flex'; else if (prefix === 'os' && tabName === 'Leer') content.style.display = 'flex'; else if (prefix === 'prod' && tabName === 'Fab') content.style.display = 'flex'; else content.style.display = 'flex'; }
    
    /* --- TOTALIZADOR --- */
    function limpiarTotalizador() {
        document.querySelectorAll('#winTotalizador input[type="text"]').forEach(i => i.value = "");
        document.getElementById('totPrecio').value = "0.00";
        document.getElementById('totCtd').value = "1";
        document.querySelector('#gridTotalizador tbody').innerHTML = "";
    }

    function verificarSerieCliente() {
        const serie = document.getElementById('totSerie').value;
        const clienteNombre = document.getElementById('txtClienteTot').value;
        
        if(!serie) return;

        // Si no hay cliente seleccionado, abrir ventana de registro (asumiendo que se debe registrar)
        if(!clienteNombre) {
             abrirVentanaProdXCliente();
             return;
        }

        const cliente = DB_CLIENTES.find(c => c.nombre === clienteNombre);
        
        let found = false;
        if(cliente && DB_SERIES_CLIENTE[cliente.id]) {
            if(DB_SERIES_CLIENTE[cliente.id].includes(serie)) found = true;
        }

        // Si el cliente existe pero la serie NO est√° en su lista, abrir ventana
        if(!found) {
            abrirVentanaProdXCliente();
        }
    }

    function buscarProductoTotalizador() {
        const desc = document.getElementById('totProdDesc').value;
        const prod = DB_PRODUCTOS.find(p => p.desc === desc);
        if(prod) {
            document.getElementById('totProdCod').value = prod.codigo.split(' ')[0];
            document.getElementById('totPrecio').value = prod.precio.toFixed(2);
            calcularSubtotalTot(); 
        }
    }

    function calcularSubtotalTot() {
        const precio = parseFloat(document.getElementById('totPrecio').value) || 0;
        const ctd = parseInt(document.getElementById('totCtd').value) || 1;
        const subtotal = (precio * ctd).toFixed(2);
        
        document.getElementById('totSubtotal').value = subtotal;
        document.getElementById('totTotal').value = subtotal; 
    }

    function agregarMovimientoTot() {
        const prod = document.getElementById('totProdDesc').value;
        const serie = document.getElementById('totSerie').value;
        const precio = document.getElementById('totPrecio').value;
        const ctd = document.getElementById('totCtd').value;
        const total = document.getElementById('totSubtotal').value;

        if(!prod || !total) return alert("Calcule el subtotal primero");

        const tbody = document.querySelector('#gridTotalizador tbody');
        const idx = tbody.rows.length + 1;
        tbody.innerHTML += `<tr><td>${idx}</td><td>${prod}</td><td>${serie}</td><td>${precio}</td><td>${ctd}</td><td>${total}</td></tr>`;
        
        // Limpiar para siguiente
        document.getElementById('totProdDesc').value = "";
        document.getElementById('totProdCod').value = "";
        document.getElementById('totPrecio').value = "0.00";
        document.getElementById('totSubtotal').value = "";
    }

    /* --- REGISTRO DE PRODUCTOS X CLIENTE --- */
    function abrirVentanaProdXCliente() {
        const nombreCliente = document.getElementById('txtClienteTot').value;
        // Si hay nombre escrito, intentamos buscarlo
        let cliente = null;
        if(nombreCliente) {
            cliente = DB_CLIENTES.find(c => c.nombre === nombreCliente);
        }

        // Llenar combo de clientes PXC
        const datalistPXC = document.getElementById('listClientesPXC');
        datalistPXC.innerHTML = '';
        DB_CLIENTES.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c.nombre;
            datalistPXC.appendChild(opt);
        });

        // Setear valor inicial si existe
        if(cliente) {
            document.getElementById('txtClientePXC').value = cliente.nombre;
            cargarGridPXC(); // Cargar series de ese cliente
        } else {
             document.getElementById('txtClientePXC').value = "";
             document.getElementById('gridPXC').innerHTML = "";
        }

        const selFab = document.getElementById('pxcFab');
        selFab.innerHTML = '<option value="">- Seleccione -</option>';
        for(let fab in DB_AUTO_PARTS) {
            selFab.innerHTML += `<option value="${fab}">${fab}</option>`;
        }
        
        abrirVentana('winProdXCliente');
    }

    function cargarGridPXC() {
        const nombreCliente = document.getElementById('txtClientePXC').value;
        const cliente = DB_CLIENTES.find(c => c.nombre === nombreCliente);
        const tbody = document.getElementById('gridPXC');
        tbody.innerHTML = '';

        if(cliente && DB_SERIES_CLIENTE[cliente.id]) {
            DB_SERIES_CLIENTE[cliente.id].forEach(serie => {
                // Simulamos marca/modelo gen√©rico ya que solo guardamos series en el ejemplo simple
                tbody.innerHTML += `<tr><td>GENERIC</td><td>MODEL</td><td>${serie}</td></tr>`;
            });
        }
    }

    function cargarModelosPXC() {
        const fab = document.getElementById('pxcFab').value;
        const selMod = document.getElementById('pxcMod');
        selMod.innerHTML = '';
        if(fab && DB_AUTO_PARTS[fab]) {
            DB_AUTO_PARTS[fab].forEach(m => {
                selMod.innerHTML += `<option value="${m.modelo}">${m.modelo}</option>`;
            });
        }
    }

    function agregarProductoACliente() {
        const fab = document.getElementById('pxcFab').value;
        const mod = document.getElementById('pxcMod').value;
        const serie = document.getElementById('pxcSerie').value;
        if(!fab || !mod || !serie) return alert("Complete los datos");
        
        // Agregar visualmente
        const tbody = document.getElementById('gridPXC');
        tbody.innerHTML += `<tr><td>${fab}</td><td>${mod}</td><td>${serie}</td></tr>`;
        
        // Guardar en memoria (Simulado)
        const nombreCliente = document.getElementById('txtClientePXC').value;
        const cliente = DB_CLIENTES.find(c => c.nombre === nombreCliente);
        if(cliente) {
             if(!DB_SERIES_CLIENTE[cliente.id]) DB_SERIES_CLIENTE[cliente.id] = [];
             DB_SERIES_CLIENTE[cliente.id].push(serie);
        }

        alert("Producto " + mod + " agregado al cliente.");
        limpiarPXCInput();
    }
    
    function limpiarPXCInput() {
        document.getElementById('pxcFab').value = "";
        document.getElementById('pxcMod').innerHTML = "";
        document.getElementById('pxcSerie').value = "";
    }
    function limpiarPXC() { limpiarPXCInput(); document.getElementById('gridPXC').innerHTML = ""; }

    /* --- REGISTRO CLIENTES --- */
    function limpiarFormularioClientes() { document.querySelectorAll('#winClientes input, #winClientes textarea').forEach(i => { if(i.id !== 'cliCodigo' && i.name !== 'modo') i.value = ""; }); document.getElementById('cliCodigo').value = "AUTO"; document.getElementById('cliBusqueda').value = ""; }
    function guardarCliente() {
        const nombre = document.getElementById('cliNombre').value;
        if (!nombre) return alert("El nombre es obligatorio");
        const modo = document.querySelector('input[name="modo"]:checked').value;
        const codigo = document.getElementById('cliCodigo').value;
        
        if (modo === 'nuevo') {
            const nuevoId = 1000 + DB_CLIENTES.length + 1;
            DB_CLIENTES.push({ id: nuevoId, nombre: nombre, direccion: document.getElementById('cliDireccion').value, colonia: document.getElementById('cliColonia').value, ciudad: document.getElementById('cliCiudad').value, estado: document.getElementById('cliEstado').value, contacto: document.getElementById('cliContacto').value, tel1: document.getElementById('cliTel1').value, tel2: document.getElementById('cliTel2').value, cp: document.getElementById('cliCP').value, email: document.getElementById('cliEmail').value, obs: document.getElementById('cliObs').value });
            alert("Cliente guardado con √©xito. ID: " + nuevoId);
        } else {
            let index = DB_CLIENTES.findIndex(c => c.id == codigo);
            if (index === -1) index = DB_CLIENTES.findIndex(c => c.nombre === nombre);
            if (index !== -1) {
                DB_CLIENTES[index].nombre = nombre; DB_CLIENTES[index].direccion = document.getElementById('cliDireccion').value; DB_CLIENTES[index].colonia = document.getElementById('cliColonia').value; DB_CLIENTES[index].ciudad = document.getElementById('cliCiudad').value; DB_CLIENTES[index].estado = document.getElementById('cliEstado').value; DB_CLIENTES[index].contacto = document.getElementById('cliContacto').value; DB_CLIENTES[index].tel1 = document.getElementById('cliTel1').value; DB_CLIENTES[index].tel2 = document.getElementById('cliTel2').value; DB_CLIENTES[index].cp = document.getElementById('cliCP').value; DB_CLIENTES[index].email = document.getElementById('cliEmail').value; DB_CLIENTES[index].obs = document.getElementById('cliObs').value;
                alert("Cliente actualizado correctamente.");
            } else { alert("Error: No se encontr√≥ el cliente para actualizar."); }
        }
        cargarListaDataList(); limpiarFormularioClientes();
    }
    function eliminarCliente() { const codigo = document.getElementById('cliCodigo').value; if (!codigo || codigo === 'AUTO') return alert("Seleccione un cliente primero para eliminar."); const confirmacion = confirm("¬øEst√° seguro de eliminar este cliente?"); if (confirmacion) { const index = DB_CLIENTES.findIndex(c => c.id == codigo); if (index !== -1) { DB_CLIENTES.splice(index, 1); alert("Cliente eliminado."); cargarListaDataList(); limpiarFormularioClientes(); } else { alert("Cliente no encontrado."); } } }
    
    /* --- ORDEN DE SERVICIO Y OTROS --- */
    function cargarClientesTotalizador() { const datalist = document.getElementById('listClientesTot'); datalist.innerHTML = ''; DB_CLIENTES.forEach(c => { const opt = document.createElement('option'); opt.value = c.nombre; datalist.appendChild(opt); }); }
    function cargarProductosTotalizador() { const datalist = document.getElementById('listProdsTot'); datalist.innerHTML = ''; DB_PRODUCTOS.forEach(p => { const opt = document.createElement('option'); opt.value = p.desc; datalist.appendChild(opt); }); }
    function toggleModoProducto(modo) { const selFab = document.getElementById('regProdFabSel'); const selMod = document.getElementById('regProdModSel'); if (modo === 'nuevo') { document.getElementById('chkProdNuevo').checked = true; selFab.innerHTML = '<option value="">- Sel -</option>'; for (let fab in DB_AUTO_PARTS) { selFab.innerHTML += `<option value="${fab}">${fab}</option>`; } selMod.innerHTML = ''; selMod.disabled = true; document.getElementById('regProdCod').value = ""; document.getElementById('regProdDesc').value = ""; document.getElementById('regProdP1').value = "0.00"; document.getElementById('regProdP2').value = "0.00"; document.getElementById('regProdP3').value = "0.00"; } else { selFab.innerHTML = '<option value="">- Sel -</option>'; for (let fab in DB_AUTO_PARTS) { selFab.innerHTML += `<option value="${fab}">${fab}</option>`; } } }
    function seleccionarFabricante() { const fab = document.getElementById('regProdFabSel').value; const selMod = document.getElementById('regProdModSel'); selMod.innerHTML = '<option value="">- Modelo -</option>'; if (fab && DB_AUTO_PARTS[fab]) { selMod.disabled = false; DB_AUTO_PARTS[fab].forEach(item => { selMod.innerHTML += `<option value="${item.modelo}">${item.modelo}</option>`; }); } else { selMod.disabled = true; } }
    function seleccionarModelo() { const fab = document.getElementById('regProdFabSel').value; const mod = document.getElementById('regProdModSel').value; if (fab && mod) { const data = DB_AUTO_PARTS[fab].find(i => i.modelo === mod); if (data) { document.getElementById('regProdCod').value = data.codigo; document.getElementById('regProdDesc').value = data.desc; document.getElementById('regProdP1').value = data.recarga.toFixed(2); document.getElementById('regProdP2').value = data.venta.toFixed(2); document.getElementById('regProdP3').value = data.reventa.toFixed(2); } } }
    function filtrarClientesOS() { const txt = document.getElementById('osCliNombre').value.toLowerCase(); const grid = document.getElementById('gridClientesOS'); grid.innerHTML = ''; if(txt.length === 0) return; DB_CLIENTES.forEach(c => { if(c.nombre.toLowerCase().includes(txt) || c.id.toString().includes(txt)) { const tr = document.createElement('tr'); tr.innerHTML = `<td>${c.id}</td><td>${c.nombre}</td><td>${c.direccion}</td>`; tr.style.cursor = 'pointer'; tr.onclick = () => seleccionarClienteOS(c, tr); grid.appendChild(tr); } }); }
    function seleccionarClienteOS(cliente, rowElement) { document.getElementById('osCliCodigo').value = cliente.id; document.getElementById('osCliNombre').value = cliente.nombre; const filas = document.getElementById('gridClientesOS').getElementsByTagName('tr'); for (let i = 0; i < filas.length; i++) filas[i].classList.remove('selected-row'); if(rowElement) rowElement.classList.add('selected-row'); }
    function cargarListaProductos() { const datalist = document.getElementById('listaProductosOS'); datalist.innerHTML = ''; DB_PRODUCTOS.forEach(p => { const option = document.createElement('option'); option.value = p.codigo; option.innerText = p.desc; datalist.appendChild(option); }); }
    function detectarPrecioProducto() { const val = document.getElementById('osProdItem').value; const prod = DB_PRODUCTOS.find(p => p.codigo === val || p.desc === val); if(prod) { document.getElementById('osValor').value = prod.precio.toFixed(2); } else { document.getElementById('osValor').value = ""; } }
    function limpiarInputsProducto() { document.getElementById('osProdItem').value = ""; document.getElementById('osCtd').value = "1"; document.getElementById('osSerie').value = ""; document.getElementById('osValor').value = ""; itemsOrden = []; dibujarGridProductos(); }
    function agregarProductoOS() { const descTipo = document.getElementById('osProdDesc').value; const codProd = document.getElementById('osProdItem').value; const ctd = document.getElementById('osCtd').value; const serie = document.getElementById('osSerie').value; const precio = document.getElementById('osValor').value; if(!codProd) return alert("Seleccione un producto"); itemsOrden.push({ tipo: descTipo, producto: codProd, serie: serie, ctd: ctd, precio: precio }); dibujarGridProductos(); document.getElementById('osProdItem').value = ""; document.getElementById('osCtd').value = "1"; document.getElementById('osSerie').value = ""; document.getElementById('osValor').value = ""; const wrapper = document.getElementById('wrapperProductos'); if(wrapper) wrapper.scrollTop = wrapper.scrollHeight; }
    function dibujarGridProductos() { const tbody = document.getElementById('gridProductosAgregados'); tbody.innerHTML = ''; itemsOrden.forEach((item, index) => { tbody.innerHTML += `<tr><td>${index + 1}</td><td>${item.tipo} - ${item.producto}</td><td>${item.serie}</td><td>${item.precio}</td></tr>`; }); }
    function generarOS() { if(!document.getElementById('osCliNombre').value) return alert("Seleccione un cliente primero"); if(itemsOrden.length === 0) return alert("Agregue al menos un producto"); const obs = document.getElementById('osObs').value; const entregaDate = document.getElementById('osFechaEntrega').value; const entregaTime = document.getElementById('osHoraEntrega').value; let entregaFull = entregaDate; if(entregaTime) entregaFull += ' ' + entregaTime; const nuevaOS = { num: 20500 + ordenesGeneradas.length + 1, cliente: document.getElementById('osCliNombre').value, fecha: new Date().toLocaleDateString(), items: [...itemsOrden], estado: 'Abierta', observaciones: obs, entrega: entregaFull }; ordenesGeneradas.push(nuevaOS); imprimirTicket(nuevaOS); itemsOrden = []; dibujarGridProductos(); document.getElementById('osCliCodigo').value = ""; document.getElementById('osCliNombre').value = ""; document.getElementById('osObs').value = ""; cerrarVentana('winOS'); abrirVentana('winListaOS'); actualizarListaOSGlobal(); }
    function actualizarListaOSGlobal() { const filtroTxt = document.getElementById('filtroClienteHistorial').value.toLowerCase(); const radios = document.getElementsByName('filtroOS'); let filtroEstado = 'todas'; for(let r of radios) if(r.checked) filtroEstado = r.value; const tbody = document.getElementById('listaOSGlobal'); tbody.innerHTML = ''; ordenesGeneradas.forEach(os => { if(filtroTxt && !os.cliente.toLowerCase().includes(filtroTxt)) return; if(filtroEstado === 'abiertas' && os.estado !== 'Abierta') return; if(filtroEstado === 'cerradas' && os.estado !== 'Cerrada') return; const descMain = os.items.length > 0 ? `${os.items[0].tipo} - ${os.items[0].producto}` : 'Sin Art√≠culos'; const tr = document.createElement('tr'); tr.innerHTML = `<td>${os.num}</td><td>${descMain}</td><td>${os.estado}</td>`; tr.onclick = () => { verDetalleOS(os); Array.from(tbody.children).forEach(row => row.classList.remove('selected-row')); tr.classList.add('selected-row'); }; tr.style.cursor = 'pointer'; tbody.appendChild(tr); }); if(!osSeleccionada) { document.getElementById('detalleOSSeleccionada').innerHTML = ''; limpiarFooterInfo(); } }
    function cerrarOSSeleccionada() { if(!osSeleccionada) return alert("Seleccione una orden de la lista primero."); if(osSeleccionada.estado === 'Cerrada') return alert("Esta orden ya se encuentra cerrada."); const confirmar = confirm("¬øDesea cerrar la O.S. #" + osSeleccionada.num + "?"); if(confirmar) { osSeleccionada.estado = 'Cerrada'; alert("Orden cerrada exitosamente."); actualizarListaOSGlobal(); document.getElementById('detalleOSSeleccionada').innerHTML = ''; limpiarFooterInfo(); osSeleccionada = null; } }
    function verDetalleOS(os) { osSeleccionada = os; const tbody = document.getElementById('detalleOSSeleccionada'); tbody.innerHTML = ''; os.items.forEach((item, idx) => { const subtotal = (item.ctd * item.precio).toFixed(2); const desc = `${item.tipo} ${item.producto}`; tbody.innerHTML += `<tr><td style="text-align:right;">${idx + 1}</td><td style="text-align:left;">${desc}</td><td style="text-align:right;">${item.producto}</td><td style="text-align:left;">${item.serie}</td><td style="text-align:left;">${item.precio}</td><td style="text-align:left;">${item.ctd}</td><td style="text-align:right;">${subtotal}</td></tr>`; }); document.getElementById('txtDetalleObs').value = os.observaciones || ''; document.getElementById('txtInfoNum').value = os.num; document.getElementById('txtInfoFecha').value = os.fecha; document.getElementById('txtInfoCliente').value = os.cliente; }
    function guardarCambiosOS() { if(!osSeleccionada) return alert("Seleccione una orden para guardar cambios."); const nuevasObs = document.getElementById('txtDetalleObs').value; osSeleccionada.observaciones = nuevasObs; alert("Observaciones actualizadas correctamente."); }
    function limpiarFooterInfo() { document.getElementById('txtInfoNum').value = ""; document.getElementById('txtInfoFecha').value = ""; document.getElementById('txtInfoCliente').value = ""; document.getElementById('txtDetalleObs').value = ""; }
    function imprimirTicket(os) { const clientData = DB_CLIENTES.find(c => c.nombre === os.cliente) || { direccion: '', tel1: '', email: '' }; let itemsHtml = ''; let total = 0; os.items.forEach((item, index) => { const subtotal = parseFloat(item.precio) * parseInt(item.ctd); total += subtotal; let desc = `${item.tipo} - ${item.producto}`; if(item.serie) desc += ` (${item.serie})`; itemsHtml += `<tr><td style="text-align:center;">${index + 1}</td><td>${desc}</td><td style="text-align:right;">${parseFloat(item.precio).toFixed(2)}</td><td style="text-align:center;">${item.ctd}</td><td style="text-align:right;">${subtotal.toFixed(2)}</td></tr>`; }); const ticketTemplate = `<div class="ticket-half"><div class="header-top">APERTURA DE LA ORDEN DE SERVICIO</div><div class="main-title">SISCOBAJIO CORTAZAR TONER Y TINTAS</div><div class="header-container"><div class="logo-box"><div class="logo-text">SISCOBAJIO</div></div><div class="info-box"><div style="border-bottom: 1px solid #ccc; padding-bottom: 3px; margin-bottom: 3px;">Dir.: Guillermo Prieto No.405-1 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Tel.: 411.155.0596</div><div class="info-row"><div style="font-weight:bold;">Cliente: ${os.cliente}</div><div>Dir.: ${clientData.direccion || ''}</div></div><div class="info-row"><div>Email: ${clientData.email || ''}</div><div>Fecha: ${os.fecha} &nbsp;&nbsp; Retirar: ${os.entrega}</div><div style="font-weight:bold;">O.S.: ${os.num}</div></div><div class="info-row"><div></div><div>Tel.: ${clientData.tel1 || ''}</div></div></div></div><div style="flex: 1;"><table><thead><tr><th style="width: 30px; text-align:center;">ART.</th><th>DESCRIPCI√ìN</th><th style="width: 80px; text-align:right;">VALOR UN.</th><th style="width: 40px; text-align:center;">X CTD</th><th style="width: 80px; text-align:right;">SUBTOTAL</th></tr></thead><tbody>${itemsHtml}</tbody></table></div><div><div class="total-box">TOTAL * &nbsp;&nbsp; $ ${total.toFixed(2)}</div><div class="obs-container"><strong>Observaciones:</strong> ${os.observaciones || 'NINGUNA'}</div><div class="footer-disclaimer">Declaro estar al tanto de la informaci√≥n</div><div class="footer-sign">Firma del Cliente</div></div></div>`; const printWin = window.open('', '', 'width=800,height=900'); printWin.document.write(`<html><head><title>O.S. #${os.num}</title><style>body { font-family: 'Arial', sans-serif; font-size: 11px; margin: 0; padding: 0; box-sizing: border-box; height: 100vh; overflow: hidden; } @media print { @page { size: letter; margin: 0.5cm; } body { margin: 0; } } .ticket-half { height: 48vh; display: flex; flex-direction: column; justify-content: space-between; padding: 10px; box-sizing: border-box; border: 1px dotted #eee; } .cut-line { height: 2vh; display: flex; align-items: center; justify-content: center; color: #666; font-size: 10px; overflow: hidden; } .cut-dashed { width: 100%; border-top: 1px dashed #666; margin: 0 10px; } .header-top { text-align: center; color: #666; font-size: 9px; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 1px; } .main-title { text-align: center; font-size: 14px; font-weight: bold; color: #333; margin: 2px 0 10px 0; } .header-container { display: flex; border-bottom: 1px solid #000; padding-bottom: 5px; margin-bottom: 5px; } .logo-box { width: 80px; height: 60px; border: 1px solid #999; border-radius: 6px; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0; } .logo-text { transform: rotate(-90deg); font-weight: bold; color: #aaa; font-size: 12px; } .info-box { flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 2px; font-size: 10px; } .info-row { display: flex; justify-content: space-between; } table { width: 100%; border-collapse: collapse; margin-top: 5px; } th { border: 1px solid #000; background: #eee; padding: 3px; font-size: 9px; font-weight: bold; text-align: left; } td { border: 1px solid #000; padding: 3px; font-size: 10px; vertical-align: middle; } .total-box { text-align: right; font-weight: bold; font-size: 12px; margin-top: 5px; padding-right: 5px; } .obs-container { margin-top: 5px; font-size: 10px; font-style: italic; border: 1px dotted #ccc; padding: 3px; } .footer-disclaimer { margin-top: 15px; text-align: right; font-size: 9px; color: #444; margin-bottom: 15px; } .footer-sign { border-top: 1px solid #000; width: 200px; text-align: center; margin-left: auto; padding-top: 2px; font-weight: bold; font-size: 10px; } </style></head><body>${ticketTemplate}<div class="cut-line"><div class="cut-dashed"></div><span>‚úÇ CORTAR AQU√ç</span><div class="cut-dashed"></div></div>${ticketTemplate}</body></html>`); printWin.document.close(); printWin.focus(); setTimeout(() => { printWin.print(); printWin.close(); }, 500); }

    let chartInstance = null;
    const DATA_MESES_FULL = { labels: ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'], data: [100, 120, 150, 170, 180, 200, 210, 190, 220, 240, 250, 300] };
    const DATA_SEMANAS_MES = { "ene": [20, 30, 25, 25], "feb": [30, 30, 30, 30], "mar": [40, 20, 50, 40], "abr": [10, 60, 50, 50] };
    function actualizarGrafico() {
        const periodo = document.getElementById('selPeriodo').value;
        const tipoSelect = document.getElementById('selTipoGrafico').value;
        const selMes = document.getElementById('selMesGrafico');
        if(periodo === 'semanas') { selMes.style.display = 'block'; } else { selMes.style.display = 'none'; }
        let chartType = tipoSelect.includes('line') ? 'line' : 'bar';
        let dataSet;
        if (periodo === 'meses') { dataSet = DATA_MESES_FULL; } else { const mesVal = selMes.value; const dataMes = DATA_SEMANAS_MES[mesVal] || [Math.random()*50, Math.random()*50, Math.random()*50, Math.random()*50]; dataSet = { labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'], data: dataMes }; }
        const ctx = document.getElementById('miGrafico').getContext('2d');
        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, { type: chartType, data: { labels: dataSet.labels, datasets: [{ label: 'Ventas', data: dataSet.data, backgroundColor: 'red', borderColor: 'darkred', borderWidth: 1, fill: false, tension: 0.1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display: false} } } });
    }

    function cargarListaDataList() { 
        const datalist = document.getElementById('listaClientes'); 
        const datalistHistorial = document.getElementById('listaClientesHistorial'); 
        const selTot = document.getElementById('listClientesTot');
        datalist.innerHTML = ''; 
        datalistHistorial.innerHTML = '';
        selTot.innerHTML = '';
        DB_CLIENTES.forEach(c => { 
            const option = document.createElement('option'); 
            option.value = c.nombre; 
            datalist.appendChild(option); 
            datalistHistorial.appendChild(option.cloneNode(true)); 
            selTot.appendChild(option.cloneNode(true));
        }); 
        cargarProductosTotalizador();
    }
    function cargarProductosTotalizador() { const datalist = document.getElementById('listProdsTot'); datalist.innerHTML = ''; DB_PRODUCTOS.forEach(p => { const opt = document.createElement('option'); opt.value = p.desc; datalist.appendChild(opt); }); }
    function detectarCliente() { const valorBusqueda = document.getElementById('cliBusqueda').value; const c = DB_CLIENTES.find(c => c.nombre === valorBusqueda); if(c) { document.getElementById('cliCodigo').value = c.id; document.getElementById('cliNombre').value = c.nombre; document.getElementById('cliDireccion').value = c.direccion; document.getElementById('cliColonia').value = c.colonia; document.getElementById('cliCiudad').value = c.ciudad; document.getElementById('cliEstado').value = c.estado; document.getElementById('cliContacto').value = c.contacto; document.getElementById('cliTel1').value = c.tel1; document.getElementById('cliTel2').value = c.tel2; document.getElementById('cliCP').value = c.cp; document.getElementById('cliEmail').value = c.email; document.getElementById('cliObs').value = c.obs; } }
    function cambiarModo(modo) { const txtBusqueda = document.getElementById('cliBusqueda'); const txtNombre = document.getElementById('cliNombre'); if(modo === 'nuevo') { limpiarFormularioClientes(); txtBusqueda.disabled = true; txtNombre.disabled = false; txtNombre.focus(); } else if (modo === 'cambiar') { txtBusqueda.disabled = false; txtNombre.value = ""; txtBusqueda.focus(); } }
    let zIndex = 100;
    function abrirVentana(id) { const win = document.getElementById(id); win.style.display = 'flex'; win.style.zIndex = ++zIndex; if(id === 'winGraficos') setTimeout(actualizarGrafico, 100); if(id === 'winProductos') { switchTab('prod', 'Fab'); toggleModoProducto('nuevo'); } }
    function cerrarVentana(id) { document.getElementById(id).style.display = 'none'; }
    function activarArrastre() { document.querySelectorAll('.title-bar').forEach(bar => { const win = bar.parentElement; let isDragging = false, startX, startY, initialLeft, initialTop; const startDrag = (e) => { isDragging = true; win.style.zIndex = ++zIndex; const cX = e.touches ? e.touches[0].clientX : e.clientX; const cY = e.touches ? e.touches[0].clientY : e.clientY; startX = cX; startY = cY; const r = win.getBoundingClientRect(); initialLeft = r.left; initialTop = r.top; }; const moveDrag = (e) => { if(!isDragging) return; e.preventDefault(); const cX = e.touches ? e.touches[0].clientX : e.clientX; const cY = e.touches ? e.touches[0].clientY : e.clientY; win.style.left = (initialLeft + (cX - startX)) + 'px'; win.style.top = (initialTop + (cY - startY)) + 'px'; }; const stopDrag = () => { isDragging = false; }; bar.addEventListener('mousedown', startDrag); document.addEventListener('mousemove', moveDrag); document.addEventListener('mouseup', stopDrag); bar.addEventListener('touchstart', startDrag, {passive:false}); document.addEventListener('touchmove', moveDrag, {passive:false}); document.addEventListener('touchend', stopDrag); }); }
</script>
</body>
</html>